name: JR Hokkaido Crawler

on:
  schedule:
    # JR運行時間帯: JST 5:00-23:00 = UTC 20:00-14:00
    # 15分毎に実行
    - cron: '*/15 20-23 * * *'  # UTC 20:00-23:45 (JST 5:00-8:45)
    - cron: '*/15 0-14 * * *'   # UTC 0:00-14:45 (JST 9:00-23:45)
  workflow_dispatch: # 手動実行用

jobs:
  crawl:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Trigger Crawler
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            "${{ secrets.CRAWLER_URL }}")
          
          if [ "$response" -ne 200 ]; then
            echo "❌ Crawler returned HTTP $response"
            exit 1
          fi
          echo "✅ Crawler executed successfully"
